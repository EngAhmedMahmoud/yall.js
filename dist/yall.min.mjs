export default function(e){const t=(e=e||{}).lazyClass||"lazy",o=e.lazyBackgroundClass||"lazy-bg",n="idleLoadTimeout"in e?e.idleLoadTimeout:200,s=e.observeChanges||!1,i=e.events||{},r=e.noPolyfill||!1,a=window,l="requestIdleCallback",d="IntersectionObserver",c=["srcset","src","poster"],u=[],b=(e,n)=>u.slice.call((n||document).querySelectorAll(e||"img."+t+",video."+t+",iframe."+t+",."+o)),v=t=>{const n=t.parentNode;"PICTURE"==n.nodeName&&m(b("source",n),f),"VIDEO"==t.nodeName&&m(b("source",t),f),f(t),t.autoplay&&t.load();const s=t.classList;s.contains(o)&&(s.remove(o),s.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},g=e=>{for(let t in i)e.addEventListener(t,i[t].listener||i[t],i[t].options||void 0)},f=e=>{for(let o in c)c[o]in e.dataset&&a.requestAnimationFrame(()=>{e.setAttribute(c[o],e.dataset[c[o]]),e.classList.remove(t)})},m=(e,t)=>{for(let o=0;o<e.length;o++)r?t(e[o]):t instanceof a[d]?t.observe(e[o]):t(e[o])},y=e=>{if(e.isIntersecting||e.intersectionRatio){const t=e.target;l in a&&n?a[l](()=>{v(t)},{timeout:n}):v(t),z.unobserve(t),(L=L.filter(e=>e!=t)).length||s||z.disconnect()}},h=e=>{L.indexOf(e)<0&&(L.push(e),g(e),z.observe(e))},p=t=>{new MutationObserver(()=>{m(b(),h)}).observe(t,e.mutationObserverOptions||{childList:!0,subtree:!0})};let L=b();if(/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent))m(L,v);else if(d in a&&d+"Entry"in a){var z=new a[d](e=>{m(e,y)},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});m(L,g),m(L,z),s&&m(b(e.observeRootSelector||"body"),p)}else r&&(m(L,g),m(L,v))}
