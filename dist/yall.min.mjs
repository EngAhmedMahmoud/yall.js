export default function(e){const t=(e=e||{}).lazyClass||"lazy",o=e.lazyBackgroundClass||"lazy-bg",s="idleLoadTimeout"in e?e.idleLoadTimeout:200,n=e.observeChanges||!1,i=e.events||{},a=e.noPolyfill||!1,r=window,l="requestIdleCallback",d="IntersectionObserver",c=["srcset","src","poster"],u=[],b=(e,s)=>u.slice.call((s||document).querySelectorAll(e||"img."+t+",video."+t+",iframe."+t+",."+o)),v=t=>{const s=t.parentNode;"PICTURE"==s.nodeName&&f(b("source",s),m),"VIDEO"==t.nodeName&&f(b("source",t),m),m(t),t.autoplay&&t.load();const n=t.classList;n.contains(o)&&(n.remove(o),n.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},g=e=>{for(let t in i)e.addEventListener(t,i[t].listener||i[t],i[t].options||void 0)},m=e=>{for(let o in c)c[o]in e.dataset&&r.requestAnimationFrame(()=>{if(e.setAttribute(c[o],e.dataset[c[o]]),"SOURCE"===e.nodeName){const o=e.parentNode;o.classList.remove(t),o.autoplay&&o.load()}e.classList.remove(t)})},f=(e,t)=>{for(let o=0;o<e.length;o++)r[d]&&t instanceof r[d]?t.observe(e[o]):t(e[o])},y=e=>{if(e.isIntersecting||e.intersectionRatio){const t=e.target;l in r&&s?r[l](()=>{v(t)},{timeout:s}):v(t),O.unobserve(t),(L=L.filter(e=>e!=t)).length||n||O.disconnect()}},p=e=>{L.indexOf(e)<0&&(L.push(e),g(e),O.observe(e))},h=t=>{new MutationObserver(()=>{f(b(),p)}).observe(t,e.mutationObserverOptions||{childList:!0,subtree:!0})};let L=b();if(/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent))f(L,v);else if(d in r&&d+"Entry"in r){var O=new r[d](e=>{f(e,y)},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});f(L,g),f(L,O),n&&f(b(e.observeRootSelector||"body"),h)}else a&&(f(L,g),f(L,v))}
