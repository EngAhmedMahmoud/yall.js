export default function(e){var t=(e=e||{}).lazyClass||"lazy",o=e.lazyBackgroundClass||"lazy-bg",r="idleLoadTimeout"in e?e.idleLoadTimeout:200,a=e.observeChanges||!1,n=e.events||{},s=e.noPolyfill||!1,i=window,d="requestIdleCallback",l="IntersectionObserver",c=l in i&&l+"Entry"in i,v=/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent),u=["srcset","src","poster"],b=[],queryDOM=(e,r)=>b.slice.call((r||document).querySelectorAll(e||"img."+t+",video."+t+",iframe."+t+",."+o)),yallLoad=t=>{var r=t.parentNode;"PICTURE"==r.nodeName&&yallApplyFn(queryDOM("source",r),yallFlipDataAttrs),"VIDEO"==t.nodeName&&yallApplyFn(queryDOM("source",t),yallFlipDataAttrs),yallFlipDataAttrs(t);var a=t.classList;a.contains(o)&&(a.remove(o),a.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},yallBindEvents=e=>{for(var t in n)e.addEventListener(t,n[t].listener||n[t],n[t].options||void 0)},yallFlipDataAttrs=e=>{for(var o in u)u[o]in e.dataset&&(e.setAttribute(u[o],e.dataset[u[o]]),"SOURCE"===e.nodeName&&e.parentNode.autoplay&&(e.parentNode.load(),e.parentNode.classList.remove(t)),e.classList.remove(t))},yallApplyFn=(e,t)=>{for(var o=0;o<e.length;o++)i[l]&&t instanceof i[l]?t.observe(e[o]):t(e[o])},yallIntersectionObserve=e=>{if(e.isIntersecting||e.intersectionRatio){var t=e.target;d in i&&r?i[d](()=>{yallLoad(t)},{timeout:r}):yallLoad(t),m.unobserve(t),(g=g.filter(e=>e!=t)).length||a||m.disconnect()}},yallMutationObserve=e=>{g.indexOf(e)<0&&(g.push(e),yallBindEvents(e),c&&!v?m.observe(e):(s||v)&&yallApplyFn(g,yallLoad))},g=queryDOM();if(c&&!v){var m=new i[l](e=>{yallApplyFn(e,yallIntersectionObserve)},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});yallApplyFn(g,yallBindEvents),yallApplyFn(g,m),a&&yallApplyFn(queryDOM(e.observeRootSelector||"body"),t=>{new MutationObserver(()=>{yallApplyFn(queryDOM(),yallMutationObserve)}).observe(t,e.mutationObserverOptions||{childList:!0,subtree:!0})})}else(s||v)&&(yallApplyFn(g,yallBindEvents),yallApplyFn(g,yallLoad))}
