export default function(e){const t=(e=e||{}).lazyClass||"lazy",o=e.lazyBackgroundClass||"lazy-bg",n="idleLoadTimeout"in e?e.idleLoadTimeout:200,s=e.observeChanges||!1,i=e.events||{},r=e.noPolyfill||!1,a=window,l="requestIdleCallback",d="IntersectionObserver",c=["srcset","src","poster"],u=[],b=(e,n)=>u.slice.call((n||document).querySelectorAll(e||"img."+t+",video."+t+",iframe."+t+",."+o)),v=t=>{const n=t.parentNode;let s;"PICTURE"==n.nodeName&&(s=n),"VIDEO"==t.nodeName&&(s=t),m(b("source",s),f),f(t),t.autoplay&&t.load();const i=t.classList;i.contains(o)&&(i.remove(o),i.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},g=e=>{for(let t in i)e.addEventListener(t,i[t].listener||i[t],i[t].options||void 0)},f=e=>{for(let t in c)c[t]in e.dataset&&a.requestAnimationFrame(()=>{e.setAttribute(c[t],e.dataset[c[t]])})},m=(e,t)=>{for(let o=0;o<e.length;o++)t instanceof a[d]?t.observe(e[o]):t(e[o])},y=e=>{if(e.isIntersecting||e.intersectionRatio){const o=e.target;l in a&&n?a[l](()=>{v(o)},{timeout:n}):v(o),o.classList.remove(t),z.unobserve(o),(L=L.filter(e=>e!=o)).length||s||z.disconnect()}},h=e=>{L.indexOf(e)<0&&(L.push(e),g(e),z.observe(e))},p=t=>{new MutationObserver(()=>{m(b(),h)}).observe(t,e.mutationObserverOptions||{childList:!0,subtree:!0})};let L=b();if(/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent))m(L,v);else if(d in a&&d+"Entry"in a){var z=new a[d](e=>{m(e,y)},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});m(L,g),m(L,z),s?m(b(e.observeRootSelector||"body"),p):r&&m(L,v)}}
